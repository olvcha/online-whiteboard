{"ast":null,"code":"import React,{useRef,useLayoutEffect,useState}from\"react\";import{useSelector,useDispatch}from\"react-redux\";import Menu from\"./Menu\";import rough from\"roughjs/bundled/rough.esm\";import{actions,toolTypes}from\"../constants\";import{createElement,updateElement,drawElement,adjustmentRequired,adjustElementCoordinates}from\"./utils\";import{v4 as uuid}from\"uuid\";import{updateElement as updateElementInStore}from\"./whiteboardSlice\";import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";let selectedElement;const setSelectedElement=el=>{selectedElement=el;};const Whiteboard=()=>{const canvasRef=useRef();const toolType=useSelector(state=>state.whiteboard.tool);const elements=useSelector(state=>state.whiteboard.elements);const[action,setAction]=useState(null);const dispatch=useDispatch();useLayoutEffect(()=>{const canvas=canvasRef.current;const ctx=canvas.getContext(\"2d\");ctx.clearRect(0,0,canvas.width,canvas.height);const roughCanvas=rough.canvas(canvas);elements.forEach(element=>{drawElement({roughCanvas,context:ctx,element});});},[elements]);const handleMouseDown=event=>{const{clientX,clientY}=event;console.log(toolType);if(toolType===toolTypes.RECTANGLE){setAction(actions.DRAWING);}const element=createElement({x1:clientX,y1:clientY,x2:clientX,y2:clientY,toolType,id:uuid()});setSelectedElement(element);dispatch(updateElementInStore(element));};const handleMouseUp=()=>{const selectedElementIndex=elements.findIndex(el=>el.id===selectedElement.id);if(selectedElementIndex!==-1){if(action===actions.DRAWING){if(adjustmentRequired(elements[selectedElementIndex].type)){const{x1,y1,x2,y2}=adjustElementCoordinates(elements[selectedElementIndex]);updateElement({id:selectedElement.id,index:selectedElementIndex,x1,x2,y1,y2,type:elements[selectedElementIndex].type},elements);}}}setAction(null);setSelectedElement(null);};const handleMouseMove=event=>{const{clientX,clientY}=event;if(action===actions.DRAWING){// find index of selected element\nconst index=elements.findIndex(el=>el.id===selectedElement.id);if(index!==-1){updateElement({index,id:elements[index].id,x1:elements[index].x1,y1:elements[index].y1,x2:clientX,y2:clientY,type:elements[index].type},elements);}}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Menu,{}),/*#__PURE__*/_jsx(\"canvas\",{onMouseDown:handleMouseDown,onMouseUp:handleMouseUp,onMouseMove:handleMouseMove,ref:canvasRef,width:window.innerWidth,height:window.innerHeight})]});};export default Whiteboard;","map":{"version":3,"names":["React","useRef","useLayoutEffect","useState","useSelector","useDispatch","Menu","rough","actions","toolTypes","createElement","updateElement","drawElement","adjustmentRequired","adjustElementCoordinates","v4","uuid","updateElementInStore","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","selectedElement","setSelectedElement","el","Whiteboard","canvasRef","toolType","state","whiteboard","tool","elements","action","setAction","dispatch","canvas","current","ctx","getContext","clearRect","width","height","roughCanvas","forEach","element","context","handleMouseDown","event","clientX","clientY","console","log","RECTANGLE","DRAWING","x1","y1","x2","y2","id","handleMouseUp","selectedElementIndex","findIndex","type","index","handleMouseMove","children","onMouseDown","onMouseUp","onMouseMove","ref","window","innerWidth","innerHeight"],"sources":["/Users/ola/Repos/online-whiteboard/src/Whiteboard/Whiteboard.js"],"sourcesContent":["import React, { useRef, useLayoutEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport Menu from \"./Menu\";\nimport rough from \"roughjs/bundled/rough.esm\";\nimport { actions, toolTypes } from \"../constants\";\nimport {\n    createElement,\n    updateElement,\n    drawElement,\n    adjustmentRequired,\n    adjustElementCoordinates,\n} from \"./utils\";\nimport { v4 as uuid } from \"uuid\";\nimport { updateElement as updateElementInStore } from \"./whiteboardSlice\";\n\nlet selectedElement;\n\nconst setSelectedElement = (el) => {\n    selectedElement = el;\n};\n\nconst Whiteboard = () => {\n    const canvasRef = useRef();\n    const toolType = useSelector((state) => state.whiteboard.tool);\n    const elements = useSelector((state) => state.whiteboard.elements);\n\n    const [action, setAction] = useState(null);\n\n    const dispatch = useDispatch();\n\n    useLayoutEffect(() => {\n        const canvas = canvasRef.current;\n        const ctx = canvas.getContext(\"2d\");\n\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n        const roughCanvas = rough.canvas(canvas);\n\n        elements.forEach((element) => {\n            drawElement({ roughCanvas, context: ctx, element });\n        });\n    }, [elements]);\n\n    const handleMouseDown = (event) => {\n        const { clientX, clientY } = event;\n        console.log(toolType);\n\n        if (toolType === toolTypes.RECTANGLE) {\n            setAction(actions.DRAWING);\n        }\n\n        const element = createElement({\n            x1: clientX,\n            y1: clientY,\n            x2: clientX,\n            y2: clientY,\n            toolType,\n            id: uuid(),\n        });\n\n        setSelectedElement(element);\n\n        dispatch(updateElementInStore(element));\n    };\n\n    const handleMouseUp = () => {\n        const selectedElementIndex = elements.findIndex(\n            (el) => el.id === selectedElement.id\n        );\n\n        if (selectedElementIndex !== -1) {\n            if (action === actions.DRAWING) {\n                if (adjustmentRequired(elements[selectedElementIndex].type)) {\n                    const { x1, y1, x2, y2 } = adjustElementCoordinates(\n                        elements[selectedElementIndex]\n                    );\n\n                    updateElement(\n                        {\n                            id: selectedElement.id,\n                            index: selectedElementIndex,\n                            x1,\n                            x2,\n                            y1,\n                            y2,\n                            type: elements[selectedElementIndex].type,\n                        },\n                        elements\n                    );\n                }\n            }\n        }\n\n        setAction(null);\n        setSelectedElement(null);\n    };\n\n    const handleMouseMove = (event) => {\n        const { clientX, clientY } = event;\n\n        if (action === actions.DRAWING) {\n            // find index of selected element\n            const index = elements.findIndex((el) => el.id === selectedElement.id);\n\n            if (index !== -1) {\n                updateElement(\n                    {\n                        index,\n                        id: elements[index].id,\n                        x1: elements[index].x1,\n                        y1: elements[index].y1,\n                        x2: clientX,\n                        y2: clientY,\n                        type: elements[index].type,\n                    },\n                    elements\n                );\n            }\n        }\n    };\n\n    return (\n        <>\n            <Menu />\n            <canvas\n                onMouseDown={handleMouseDown}\n                onMouseUp={handleMouseUp}\n                onMouseMove={handleMouseMove}\n                ref={canvasRef}\n                width={window.innerWidth}\n                height={window.innerHeight}\n            />\n        </>\n    );\n};\n\nexport default Whiteboard;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}